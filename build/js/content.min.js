$(function(){var displatyFailedResult,displatySuccessResult,getToken,save2Server,scrapingMetaData;return save2Server=function(data,token){return new Promise(function(resolve,reject){var destUrl;return destUrl="https://127.0.0.1:9021/api/posts",$.ajax({type:"POST",url:destUrl,data:{token:token,post:data},headers:{"Access-Control-Allow-Origin":"*"}}).done(function(data){return resolve(data)}).fail(function(err){return reject(err)})})},getToken=function(){return new Promise(function(resolve,reject){return chrome.storage.sync.get(["token"],function(item){return void 0===item.token||""===item.token?reject(void 0):resolve(item.token)})})},scrapingMetaData=function(){return new Promise(function(resolve,reject){var $img,DEFUALT_URL,data,description1,description2,favicon,firstImgUrlInBody,hostName,siteImage,siteName,siteUrl1,siteUrl2,title1,title2;return data={},title1=$("head title").text(),title2=$('meta[property="og:title"]').attr("content"),data.title=("undefined"!=typeof info&&null!==info?info.title:void 0)||title1||title2,siteName=$('meta[property="og:site_name"').text(),data.siteName=siteName,siteUrl1=$(location).attr("href"),siteUrl2=$('meta[property="og:url"]').attr("content"),data.siteUrl=("undefined"!=typeof info&&null!==info?info.siteUrl:void 0)||siteUrl1||siteUrl2,"image"===("undefined"!=typeof info&&null!==info?info.type:void 0)||null!=("undefined"!=typeof info&&null!==info?info.mediaType:void 0)&&"image"===("undefined"!=typeof info&&null!==info?info.menuItemId:void 0)?(data.type="image",data.url=info.srcUrl):(data.type="link",$img=$("img"),DEFUALT_URL="https://36.media.tumblr.com/9086462174c34becaf8b3e59de8f5800/tumblr_nzek2kWNNJ1ukgdjoo2_1280.jpg",null!=$img&&$img.length>0?(firstImgUrlInBody=$img.get(0).src,data.url=firstImgUrlInBody||DEFUALT_URL):data.url=DEFUALT_URL,data.url.indexOf("chrome-extension://")>-1&&(data.url=$img.get(1).src),siteUrl1.indexOf("www.nicovideo.jp/watch/sm")>-1&&(data.url=$(".videoThumbnailImage").attr("src")),siteUrl1.indexOf("xvideos.com/video")>-1&&(data.url=$("img.thumb").attr("src"))),hostName=location.host,data.hostName=hostName,description1=$('meta[name="description"]').attr("content"),description2=$('meta[property="og:description"]').attr("content"),data.description=description1||description2,siteImage=$('meta[property="og:image"]').attr("content"),data.siteImage=siteImage,favicon=$('link[rel="shortcut icon"]').prop("href"),data.favicon=favicon,data.isPrivate=!0,data.isArchive=!1,resolve(data)})},displatySuccessResult=function(){return chrome.runtime.sendMessage({newIconPath:"build/images/blue/icon19.png"}),alertify.success("保存しました。")},displatyFailedResult=function(err){return null!=err.responseJSON?(err.statusCode=err.responseJSON.statusCode,err.statusMessage=err.responseJSON.message):null!=err.status&&(err.statusCode=err.status,err.statusMessage=err.statusText),alertify.error(err.statusCode?"Error: "+err.statusCode+" "+err.statusMessage:"Error: トークンに誤りがあります。\nもう一度確認してみてください。")},function(){return alertify.log("保存中 ......"),Promise.all([scrapingMetaData(),getToken()]).then(function(arg){var data,token;return data=arg[0],token=arg[1],save2Server(data,token)}).then(function(data){return displatySuccessResult()})["catch"](function(err){return displatyFailedResult(err)})}()});